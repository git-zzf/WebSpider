# 爬取网页的通用代码框架

*一组代码，可以准确可靠得爬取网页上的内容*

****

使用request库进行网页访问的时候经常用get函数，requests.get(url) 获得url的相关内容。但是网络连接可能会发生异常，需要进行异常处理。

| 异常                      | 说明                                                         |
| ------------------------- | ------------------------------------------------------------ |
| requests.ConnectionError  | 网络连接错误异常，如对URL进行DNS查询失败、拒绝连接等         |
| requests.HTTPError        | HTTP协议层面错误异常                                         |
| requests.URL.Required     | URL缺失异常                                                  |
| requests.TooManyRedirects | 超过最大重定向次数，产生重定向异常，通常是对复杂链接访问的时候发生的异常 |
| requests.ConnectTimeout   | 连接远程服务器超时异常                                       |
| requests.Timeout          | 请求URL超时，产生超时异常                                    |

**requests.ConnectTimeout**和**requests.Timeout**区别：

Timeout是指发出URL请求到获得内容的整个过程的超时异常，ConnectTimeout仅指与远程服务器连接过程产生的超时异常

****

## Response对象对于处理异常的方法

| 异常                 | 说明                                    |
| -------------------- | --------------------------------------- |
| r.raise_for_status() | 如果不是200，产生异常requests.HTTPError |

专门处理异常，能够判断返回的response类型r的状态是不是200，如果是200，就会显示返回的内容是正确的，如果不是200，就会产生一个HTTPRError的异常

****

## 通用代码框架

```python
def getHTMLText(url):
    try:
        r = requests.get(url, timeout = 30)
        r.raise_for_status() #如果状态不是200，引发HTTPError异常
        r.encoding = r.apparent_encoding
        return r.text
    except:
        return "产生异常"
```

完整代码

```python
import requests

def getHTMLText(url):
    try:
        r = requests.get(url, timeout = 30)
        r.raise_for_status() #如果状态不是200，引发HTTPError异常
        r.encoding = r.apparent_encoding
        return r.text
    except:
        return "产生异常"
    
if __name__ == "__main__":
    url = "http://www.baidu.com"
    print(getHTMLText(url))
```

****

## 使用通用代码框架

 可以有效处理在访问或爬取网页过程中可能出现的错误，或者网络不稳定造成的现象

```python
if __name__ == "__main__":
    url = "http://www.baidu.com"
    print(getHTMLText(url))```
```

正常情况会获得百度首页的HTML代码

```python
if __name__ == "__main__":
    url = "www.baidu.com"
    print(getHTMLText(url))
```

如果去掉http://之后，会发生异常，这时候会返回`产生异常`