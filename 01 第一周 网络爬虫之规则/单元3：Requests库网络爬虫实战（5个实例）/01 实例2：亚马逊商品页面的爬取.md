# 实例2：亚马逊商品页面的爬取

## 直接爬取

```python
>>> import requests
>>> r = requests.get("https://www.amazon.cn/dp/B01FLG4O04")
>>> r.status_code
503
>>> r.encoding
'ISO-8859-1'
>>> r.encoding = r.apparent_encoding
>>> r.text
```

返回的503，说明遇到了问题

网站可以通过判断头来判断访问是谁发起的，网站处理的是通过浏览器访问的请求，如果是对于爬虫的请求，网站可以拒绝

## 查看头信息

通过r.request.header查看发给亚马逊的头部是什么内容

```python
>>> r.request.headers
{'User-Agent': 'python-requests/2.23.0', 'Accept-Encoding': 'gzip, deflate', 'Accept': '*/*', 'Connection': 'keep-alive'}
```

在User-Agent中写着python-requests，说明我们的爬虫告诉亚马逊，这次访问是由程序产生的。亚马逊就可以使这样的访问变成错误。

## 更改头信息

```python
>>> kv = {'user-agent':'Mozilla/5.0'} 
```

重新定义user-agent的内容，使它等于Mozilla/5.0，这时候的user-agent可能是一个浏览器，可能是火狐，可能是Mozilla或者是IE10。因为Mozilla/5.0是一个很标准的浏览器身份标识的字段。

```python
>>> kv = {'user-agent':'Mozilla/5.0'} 
>>> url = "https://www.amazon.cn/dp/B01FLG4O04"
>>> r = requests.get(url, hearders = kv)
>>> r.status_code
200
```

这时候返回变成了200，说明现在获得了产品页面

```python
>>> r.request.headers
{'user-agent': 'Mozilla/5.0', 'Accept-Encoding': 'gzip, deflate', 'Accept': '*/*', 'Connection': 'keep-alive'}
```

这时候的user-agent已经被改成了Mozilla/5.0

```python
>>> r.text
```

这时候可以看到商品信息了

****

## 全代码

```python
import requests
url = "https://www.amazon.cn/dp/B01FLG4O04"
try:
    kv = {'user-agent':'Mozilla/5.0'}
	r = requests.get("url", heards = kv)
	r.raise_for_status()
	r.encoding = r.apparent_encoding
	print(r.text[1000:2000])
except:
    print("爬取失败")
```

****

实际中遇到验证码检测 QAQ