# 实例4：网络图片的爬取和储存

## 网络图片链接的格式

`http://www.example.com/picture.jpg`

前面是URL，结尾是picture.jpg

### 例子：国家地理	

`http://www.nationalgeographic.com.cn/`

选择一个图片web页面：

`http://www.nationalgeographic.com.cn/photography/photo_of_the_day/3921.html`

这张图片是这样的格式：

`http://image.nationalgeographic.com.cn/2017/0211/20170211061910157.jpg`

如果一个URL链接是以.jpg结尾说明它就是一个图片链接，而且它是一个文件，所以我们需要用程序把它爬取并保存下来。

# 实践

### 获取图片

```python
>>> import requests
```

需要描述把图片保存在本机的什么位置

假设保存到E盘，保存为abc.jpg这个文件

这个名字后期会做相关处理

```python
>>> path = "E:/Notes/WebCrawler/第一周 网络爬虫之规则/单元3：Requests库网络爬虫实战（5个实例）/实例4图片/abc.jpg"
```

给出查到的网络图片的地址

```python
>>> url = "http://image.nationalgeographic.com.cn/2017/0211/20170211061910157.jpg"
```

用get请求来捕获url

```python
>>> r = requests.get(url)
>>> r.status_code
200
```

显示200说明保存成功

### 保存图片

图片是一个二进制格式，保存二进制格式文件为图片

```python
>>> with open(path, 'wb') as f:
    	f.write(r.content)
```

打开一个文件，即我们要存储的abc.jpg并且把它定义为一个文件标识符f

任何我们将返回的内容写到这个文件中

response对象返回的内容中，r.content表示返回内容的二进制形式。所以我们可以用f.write(r.content)将返回的二进制形式写到文件中。

最后, 我们将文件关闭

```python
>>> f.close()
```

去E盘看下这个文件

<img src="实例4图片/abc.jpg" style="zoom: 25%;" />

****

## 图片爬取全代码

```python
import requests
import os
url = "http://image.nationalgeographic.com.cn/2017/0211/20170211061910157.jpg"
root = "E:/Notes/WebCrawler/第一周 网络爬虫之规则/单元3：Requests库网络爬虫实战（5个实例）/实例4图片/" 
path = root + url.split('/')[-1]
try:
    if not os.path.exists(root):
        os.mkdir(root)
    if not os.path.exists(path):
        r = requests.get(url)
        with open(path, 'wb') as f:
            f.write(r.content)
            f.close()
            print("文件保存成功")
    else:
        print("文件已存在")
except:
    print("爬取失败")
              
```

`path = root + url.split('/')[-1]`表示本地目录加上正斜杠分割的最后一部分，即文件名，这样就不用加文件名了，保存的文件名称就是原名称。

地址用/分割就可以了，不需要//

```python
if not os.path.exists(root):
        os.mkdir(root)
```

查看根目录是否存在，如果不存在，建立一个目录。

```python
if not os.path.exists(path):
        r = requests.get(url)
        withopen(path, 'wb') as f:
            f.write(r.content)
            f.close()
            print("文件保存成功")
    else:
        print("文件已存在")
```

接下来查看文件是否存在，如果不存在，就通过request下载文件，如果存在，就打印”文件已存在“

### 代码的可靠和稳定性

要考虑可能出现的问题，并能做相关处理

