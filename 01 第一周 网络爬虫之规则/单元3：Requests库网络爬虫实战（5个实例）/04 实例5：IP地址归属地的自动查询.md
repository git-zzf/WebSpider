# 实例5:  IP地址归属地的自动查询

## 通过iP138网站查询

接口形式：

`http://m.ip138.com/ip.asp?ip=ipaddress`

## 实现

```python
>>> import requests
>>> url = "http://ip138.com/iplookup.asp?ip="
>>> kv = {'user-agent':'Mozilla/5.0'}
>>> r = requests.get(url + '202.204.80.112'+'&action=2',headers = kv)
>>> r.status_order
>>> r.text[7000:7500]
```

查询最后500个字节

## 全代码

```python
import requests
url = "http://ip138.com/iplookup.asp?ip="
kv = {'user-agent':'Mozilla/5.0'}
try:
    r = requests.get(url + '202.204.80.112'+'&action=2',headers = kv)
    r.raise_for_status()
    r.encoding = r.apparent_encoding
    print(r.text[7000:7500])
except:
    print("爬取失败")

```

网站以文本框提交按钮的形式，都是以链接的形式提交的。只要通过浏览器的解析，知道向后台提交的链接形式，就可以用Python代码模拟。

实际中需要伪装头信息

55.55.55.55 美国   弗吉尼亚美国陆军部队IP地址